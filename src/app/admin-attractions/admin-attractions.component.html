<div class="admin-container">
  <!-- Header -->
  <div class="admin-header">
    <div class="header-left">
      <h1 class="page-title">
        <mat-icon class="title-icon">admin_panel_settings</mat-icon>
        Administration des Attractions
      </h1>
      <p class="page-subtitle">
        Gérez toutes les attractions touristiques de votre plateforme
      </p>
    </div>
    
    <div class="header-actions">
      <button 
        mat-raised-button 
        color="primary"
        (click)="openCreateDialog()"
        class="create-button">
        <mat-icon>add</mat-icon>
        Nouvelle Attraction
      </button>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-cards">
    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon total-icon">
            <mat-icon>location_on</mat-icon>
          </div>
          <div class="stat-info">
            <div class="stat-number">{{ totalItems }}</div>
            <div class="stat-label">Attractions</div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

     <mat-card class="stat-card">
        <mat-card-content>
        <div class="stat-content">
            <div class="stat-icon active-icon">
            <mat-icon>check_circle</mat-icon>
            </div>
            <div class="stat-info">
            <div class="stat-number">
                {{ getActiveAttractionsCount() }}
            </div>
            <div class="stat-label">Actives</div>
            </div>
        </div>
        </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
        <mat-card-content>
        <div class="stat-content">
            <div class="stat-icon featured-icon">
            <mat-icon>star</mat-icon>
            </div>
            <div class="stat-info">
            <div class="stat-number">
                {{ getFeaturedAttractionsCount() }}
            </div>
            <div class="stat-label">En Vedette</div>
            </div>
        </div>
        </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
        <mat-card-content>
        <div class="stat-content">
            <div class="stat-icon visitors-icon">
            <mat-icon>people</mat-icon>
            </div>
            <div class="stat-info">
            <div class="stat-number">
                {{ getTotalVisitors() }}
            </div>
            <div class="stat-label">Visiteurs Actuels</div>
            </div>
        </div>
        </mat-card-content>
    </mat-card>
  </div>

  <!-- Filters Section -->
  <mat-card class="filters-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>filter_list</mat-icon>
        Filtres de recherche
      </mat-card-title>
      <button 
        mat-button 
        color="warn" 
        (click)="clearFilters()"
        class="clear-filters-btn">
        <mat-icon>clear_all</mat-icon>
        Réinitialiser
      </button>
    </mat-card-header>
    
    <mat-card-content>
      <div class="filters-grid">
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Recherche</mat-label>
          <input 
            matInput 
            [(ngModel)]="searchQuery" 
            placeholder="Nom, ville, description..."
            (keyup.enter)="applyFilters()">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Catégorie</mat-label>
          <mat-select [(ngModel)]="selectedCategory">
            <mat-option value="">Toutes les catégories</mat-option>
            <mat-option *ngFor="let category of categories" [value]="category">
              {{ getCategoryDisplay(category) }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Ville</mat-label>
          <mat-select [(ngModel)]="selectedCity">
            <mat-option value="">Toutes les villes</mat-option>
            <mat-option *ngFor="let city of cities" [value]="city">
              {{ city }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <button 
          mat-raised-button 
          color="primary" 
          (click)="applyFilters()"
          class="apply-filters-btn">
          <mat-icon>filter_alt</mat-icon>
          Appliquer les filtres
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Table Section -->
  <mat-card class="table-card">
    <mat-card-content>
      <div class="table-container">
        <div class="table-loading" *ngIf="loading">
          <mat-spinner diameter="40"></mat-spinner>
          <p>Chargement des attractions...</p>
        </div>

        <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z0">
          
          <!-- ID Column -->
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
            <td mat-cell *matCellDef="let attraction" [class]="getRowClass(attraction)">
              {{ attraction.id }}
            </td>
          </ng-container>

          <!-- Nom Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Nom</th>
            <td mat-cell *matCellDef="let attraction" [class]="getRowClass(attraction)">
              <div class="attraction-name">
                <mat-icon *ngIf="attraction.isFeatured" class="featured-star">star</mat-icon>
                <span>{{ attraction.name }}</span>
                <mat-chip *ngIf="!attraction.isActive" color="warn" class="status-chip">
                  <mat-icon>block</mat-icon>
                  Inactive
                </mat-chip>
              </div>
            </td>
          </ng-container>

          <!-- Catégorie Column -->
          <ng-container matColumnDef="category">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Catégorie</th>
            <td mat-cell *matCellDef="let attraction" [class]="getRowClass(attraction)">
              <mat-chip [style.background]="getCategoryColor(attraction.category)">
                {{ getCategoryDisplay(attraction.category) }}
              </mat-chip>
            </td>
          </ng-container>

          <!-- Ville Column -->
          <ng-container matColumnDef="city">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Ville</th>
            <td mat-cell *matCellDef="let attraction" [class]="getRowClass(attraction)">
              <div class="city-cell">
                <mat-icon>location_on</mat-icon>
                <span>{{ attraction.location?.city || 'Non spécifiée' }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Prix Column -->
          <ng-container matColumnDef="entryPrice">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Prix d'entrée</th>
            <td mat-cell *matCellDef="let attraction" [class]="getRowClass(attraction)">
              <span *ngIf="attraction.entryPrice; else free">
                {{ attraction.entryPrice | currency:'EUR':'symbol':'1.2-2' }}
              </span>
              <ng-template #free>
                <mat-chip color="primary">Gratuit</mat-chip>
              </ng-template>
            </td>
          </ng-container>

          <!-- Visiteurs Column -->
          <ng-container matColumnDef="currentVisitors">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Visiteurs</th>
            <td mat-cell *matCellDef="let attraction" [class]="getRowClass(attraction)">
              <div class="visitors-cell">
                <div class="visitors-info">
                  <span class="current-visitors">{{ attraction.currentVisitors || 0 }}</span>
                  <span class="max-capacity" *ngIf="attraction.maxCapacity">
                    / {{ attraction.maxCapacity }}
                  </span>
                  <mat-progress-bar 
                    *ngIf="attraction.maxCapacity && attraction.maxCapacity > 0"
                    mode="determinate" 
                    [value]="(attraction.currentVisitors || 0) / attraction.maxCapacity * 100"
                    [color]="getOccupancyColor(attraction)">
                  </mat-progress-bar>
                </div>
              </div>
            </td>
          </ng-container>

          <!-- Note Column -->
          <ng-container matColumnDef="rating">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Note</th>
            <td mat-cell *matCellDef="let attraction" [class]="getRowClass(attraction)">
              <div class="rating-cell">
                <div class="rating-stars">
                  <mat-icon *ngFor="let star of [1,2,3,4,5]" 
                    [class.filled]="star <= (attraction.rating || 0)">
                    {{ star <= (attraction.rating || 0) ? 'star' : 'star_border' }}
                  </mat-icon>
                </div>
                <span class="rating-value">{{ attraction.rating?.toFixed(1) || '0.0' }}</span>
                <span class="reviews-count" *ngIf="attraction.totalReviews">
                  ({{ attraction.totalReviews }})
                </span>
              </div>
            </td>
          </ng-container>

          <!-- Statut Actif Column -->
          <ng-container matColumnDef="isActive">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Statut</th>
            <td mat-cell *matCellDef="let attraction" [class]="getRowClass(attraction)">
              <mat-slide-toggle
                [checked]="attraction.isActive"
                (change)="toggleActiveStatus(attraction)"
                color="primary">
                {{ attraction.isActive ? 'Active' : 'Inactive' }}
              </mat-slide-toggle>
            </td>
          </ng-container>

          <!-- Vedette Column -->
          <ng-container matColumnDef="isFeatured">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Vedette</th>
            <td mat-cell *matCellDef="let attraction" [class]="getRowClass(attraction)">
              <mat-slide-toggle
                [checked]="attraction.isFeatured"
                (change)="toggleFeaturedStatus(attraction)"
                color="accent">
                {{ attraction.isFeatured ? 'Oui' : 'Non' }}
              </mat-slide-toggle>
            </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let attraction" [class]="getRowClass(attraction)">
              <div class="action-buttons">
                <button 
                  mat-icon-button 
                  color="primary"
                  (click)="openEditDialog(attraction)"
                  matTooltip="Modifier">
                  <mat-icon>edit</mat-icon>
                </button>
                
                <button 
                  mat-icon-button 
                  color="warn"
                  (click)="confirmDelete(attraction)"
                  matTooltip="Supprimer">
                  <mat-icon>delete</mat-icon>
                </button>
                
                <button 
                  mat-icon-button 
                  color="accent"
                  [routerLink]="['/attractions', attraction.id]"
                  matTooltip="Voir détails">
                  <mat-icon>visibility</mat-icon>
                </button>

                <button 
                  mat-icon-button 
                  color="accent"
                  (click)="openNotificationDialog(attraction)"
                  matTooltip="Créer une notification">
                  <mat-icon>notifications</mat-icon>
                </button>

              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

          <!-- Empty state -->
          <tr class="empty-row" *matNoDataRow>
            <td [attr.colspan]="displayedColumns.length">
              <div class="empty-state">
                <mat-icon>location_off</mat-icon>
                <h3>Aucune attraction trouvée</h3>
                <p *ngIf="searchQuery || selectedCategory || selectedCity">
                  Essayez de modifier vos filtres de recherche
                </p>
                <p *ngIf="!searchQuery && !selectedCategory && !selectedCity">
                  Aucune attraction n'est disponible pour le moment
                </p>
                <button 
                  mat-raised-button 
                  color="primary"
                  (click)="openCreateDialog()">
                  <mat-icon>add</mat-icon>
                  Créer la première attraction
                </button>
              </div>
            </td>
          </tr>
        </table>
      </div>

      <!-- Pagination -->
      <mat-paginator 
        [length]="totalItems"
        [pageSize]="pageSize"
        [pageSizeOptions]="[5, 10, 25, 50]"
        [pageIndex]="pageIndex"
        (page)="onPageChange($event)"
        showFirstLastButtons
        class="custom-paginator">
      </mat-paginator>
    </mat-card-content>
  </mat-card>

</div>